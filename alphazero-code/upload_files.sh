#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

SERVER="root@91.186.197.89"
SERVER_PASS="sP+FkvHKi-7,W2"
SERVER_DIR="/var/www/togyzqumalaq"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è sshpass
if command -v sshpass &> /dev/null; then
    SSH_CMD="sshpass -p '$SERVER_PASS' ssh"
    SCP_CMD="sshpass -p '$SERVER_PASS' scp"
else
    echo "‚ö†Ô∏è  sshpass –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ë—É–¥–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω –ø–∞—Ä–æ–ª—å."
    SSH_CMD="ssh"
    SCP_CMD="scp"
fi

echo "üì¶ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä..."

# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
$SSH_CMD $SERVER "mkdir -p $SERVER_DIR/static $SERVER_DIR/game_logs"

# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
echo "üìÑ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤..."
$SCP_CMD index.html styles.css game.js mcts-worker.js $SERVER:$SERVER_DIR/static/

# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã
echo "üêç –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
$SCP_CMD server.py requirements.txt setup_server.sh add_nginx_config.sh $SERVER:$SERVER_DIR/

echo "‚úÖ –§–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!"
echo ""
echo "–¢–µ–ø–µ—Ä—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
echo "  ssh $SERVER"
echo "  cd $SERVER_DIR"
echo "  chmod +x setup_server.sh"
echo "  ./setup_server.sh"

